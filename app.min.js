let card__add2carts = document.querySelectorAll(".card__add2cart");

for (var i = 0; i < card__add2carts.length; i++) {
  //this.classList.remove('card__variant_active');
  card__add2carts[i].onclick = async function(e){

    let button = this;
    button.classList.add('card__add2cart_load');

    let query = await fetch('/add2cart.php');
    let response = await query.json();
    if(response.result === 'success') {
      button.classList.remove('card__add2cart_load');


      if(document.getElementsByClassName('navigation__item_target_cart-full').length  <= 0) {
        document.querySelector(".navigation__item_target_cart").classList.add('navigation__item_target_cart-full');
      }

      button.classList.add('card__add2cart_active');
    }
    

    // get_json('/add2cart.php', {item_id: button.getAttribute('data-item')})
    //             .then(data => function(data, button) {
    //               console.log(data);
    //               button.classList.add('card__add2cart_active');
    //             })
    //             .catch(error => console.error(error));

    // e.target.closest(".card").querySelector(".card__price").innerHTML = this.getAttribute('data-price') + ' руб';
    // e.target.closest(".card").querySelector(".card__image").setAttribute('src', this.getAttribute('data-image'));
    // e.target.closest(".card").querySelector(".card__add2cart").setAttribute('data-item', this.getAttribute('data-item'));
    
    // let all_children_variants = e.target.closest(".card").querySelectorAll(".card__variant");
    // for (var ii = 0; ii < all_children_variants.length; ii++) {
    //   all_children_variants[ii].classList.remove('card__variant_active');
    // }
    // this.classList.add('card__variant_active');
    
  };
}
// document.querySelectorAll('.card__variant').addEventListener('click', function() {
//   console.log('sdf');
// });


// document.getElementsByClassName('.card__variant').onclick = function (e) {
//   console.log('222');

// //   console.log(this.getAttribute('data-id'));

// //   // if (e.target.matches('.card__variant_active')) {
// //   //   alert('1');
// //   // } else {
// //   //   alert('2');
// //   // }
  
// //   // console.log('222');
// //   // if(this.classList.contains('card__variant_active') === true) {
// //   //   return false;
// //   // } 
  
  
  
// };

let card__variants = document.querySelectorAll(".card__variant");
for (var i = 0; i < card__variants.length; i++) {
  //this.classList.remove('card__variant_active');
  card__variants[i].onclick = function(e){
    e.target.closest(".card").querySelector(".card__price").innerHTML = this.getAttribute('data-price') + ' руб';
    e.target.closest(".card").querySelector(".card__image").setAttribute('src', this.getAttribute('data-image'));
    e.target.closest(".card").querySelector(".card__add2cart").setAttribute('data-item', this.getAttribute('data-item'));
    
    let all_children_variants = e.target.closest(".card").querySelectorAll(".card__variant");
    for (var ii = 0; ii < all_children_variants.length; ii++) {
      all_children_variants[ii].classList.remove('card__variant_active');
    }
    this.classList.add('card__variant_active');
    
  };
}
document.querySelector('.header__search').onclick = function (e) {
  let header__search_fieldset = document.querySelector('.header__search-fieldset');

  if (
    !e.target.matches('.header__search .header__search-fieldset') && 
    !e.target.matches('.header__search .header__search-input') && 
    getComputedStyle(header__search_fieldset)['position'] == 'fixed'
    ) {
    overlay();
    document.querySelector('.header__search-fieldset').classList.add('header__search-fieldset_active');
    document.querySelector('.header__search-input').focus();
  }
};


document.querySelector('.navigation__item_target_directory').onclick = function (e) {
  if (e.target.matches('.navigation__link')) {
    
    if(document.querySelector('.navigation__directory').classList.contains('navigation__directory_active')) {
      document.querySelector('.navigation__directory').classList.remove('navigation__directory_active');
    } else {
      document.querySelector('.navigation__directory').classList.add('navigation__directory_active');
    }
    overlay();
  }

  // if (e.target.matches('.navigation__link')) {
  //   overlay();
  //  // document.querySelector('.overlay').classList.add('overlay_active');
  //   document.querySelector('.navigation__directory').classList.add('navigation__directory_active');
  // } else {
  //   overlay();
  //   document.querySelector('.navigation__directory').classList.remove('navigation__directory_active');
  // }
};

document.querySelector('.navigation__directory-item_type_header').onclick = function (e) {
  overlay();
  document.querySelector('.navigation__directory').classList.remove('navigation__directory_active');
 // document.querySelector('.body').removeChild(document.querySelector('.overlay'));
};

function get_json(url, data) {
  return fetch(url, {
      credentials: 'same-origin',  // параметр определяющий передвать ли разные сессионные данные вместе с запросом
      method: 'POST',              // метод POST
      body: JSON.stringify(data),  // типа запрашиаемого документа
      headers: new Headers({
          'Content-Type': 'application/json'
      }),
  })
      .then(response => response.json()) // возвращаем промис
}
function overlay() {
  let overlay = document.querySelector('.overlay');

  if(getComputedStyle(overlay)['opacity'] == '1') {
    document.querySelector('.overlay').classList.remove('overlay_active');
  } else {
    document.querySelector('.overlay').classList.add('overlay_active');
  }

  // if(document.querySelector('.overlay') === null) {
  //   let overlay_on = document.createElement('div');
  //   overlay_on.classList.add('overlay');
  //   overlay_on.classList.add('overlay_active');
  //   document.querySelector('.body').insertBefore(overlay_on, document.querySelector('.modal'));
  // } else {
  //   document.querySelector('.body').removeChild(document.querySelector('.overlay'));
  // }

  document.querySelector('.overlay').onclick = function (e) {
    document.querySelector('.overlay').classList.remove('overlay_active');
    document.querySelector('.header__search-fieldset').classList.remove('header__search-fieldset_active');
    document.querySelector('.navigation__directory').classList.remove('navigation__directory_active');
   // document.querySelector('.body').removeChild(document.querySelector('.overlay'));
  };
}

// function activate_item(selector) {
//   let activate_container = document.querySelector('.' + selector);
//   if(!activate_container.classList.contains(selector + '_active')) {
//     activate_container.classList.add(selector + '_active');
//   } 
// }
// function deactivate_item(selector) {
//   let deactivate_container = document.querySelector('.' + selector);
//   if(deactivate_container.classList.contains(selector + '_active')) {
//     deactivate_container.classList.remove(selector + '_active');
//   } 
// }